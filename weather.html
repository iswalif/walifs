<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>weather · minimal</title>
  <!-- Font Awesome for icons -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <style>
    
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      -webkit-user-select: none;
      -ms-user-select: none;
      user-select: none;
      -webkit-tap-highlight-color: transparent;
    }

    html, body {
      height: 100%;
      background: #0e0e0e;
      color: #e5e5e5;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
      overflow: hidden;
    }

    body {
      display: flex;
      flex-direction: column;
    }

    /* ----- lofi navigation ----- */
    nav {
      display: flex;
      justify-content: space-between;
      padding: 16px 24px;
      font-size: 13px;
      letter-spacing: 0.25em;
      text-transform: lowercase;
      opacity: 0.75;
    }

    /* ----- main layout (centered) ----- */
    main {
      flex: 1;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-direction: column;
      gap: 28px;
      padding: 20px;
    }

    /* ----- search row (borderless) ----- */
    .search-row {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      justify-content: center;
    }

    .search-input {
      background: transparent;
      border: none;               /* removed border */
      color: #e5e5e5;
      padding: 12px 18px;
      border-radius: 40px;
      font-size: 13px;
      letter-spacing: 0.1em;
      min-width: 200px;
      font-family: inherit;
    }

    .search-input:focus {
      outline: none;
      background: rgba(229,229,229,0.1);
    }

    .search-input::placeholder {
      color: #e5e5e5;
      opacity: 0.5;
      letter-spacing: 0.1em;
    }

    /* ----- lofi buttons (borderless) ----- */
    .btn {
      background: transparent;
      border: none;               /* removed border */
      color: #e5e5e5;
      width: 48px;
      height: 48px;
      border-radius: 50%;
      font-size: 14px;
      cursor: pointer;
      transition: all 0.3s ease;
      display: inline-flex;
      align-items: center;
      justify-content: center;
    }

    .btn:hover {
      background: #e5e5e5;
      color: #0e0e0e;
    }

    .unit-toggle {
      width: auto;
      padding: 0 18px;
      border-radius: 40px;
      font-size: 13px;
      letter-spacing: 0.1em;
    }

    /* ----- weather card (borderless) ----- */
    .weather-card {
      border: none;               /* removed border */
      border-radius: 32px;
      padding: 32px 28px;
      max-width: 400px;
      width: 100%;
      background: transparent;
      display: flex;
      flex-direction: column;
      gap: 24px;
    }

    /* location line */
    .location {
      font-size: 13px;
      letter-spacing: 0.25em;
      text-transform: lowercase;
      opacity: 0.75;
      text-align: center;
    }

    /* main temperature + icon row */
    .main-temp {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 15px;
    }

    .temp {
      font-size: 5rem;
      font-weight: 300;
      line-height: 1;
    }

    .main-icon {
      font-size: 2.8rem;
      opacity: 0.9;
    }

    /* stats grid (two columns, minimal) */
    .stats-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 18px 20px;
      margin-top: 8px;
    }

    .stat-item {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 13px;
      letter-spacing: 0.1em;
      text-transform: lowercase;
      opacity: 0.8;
    }

    .stat-item i {
      width: 20px;
      font-size: 1.1rem;
      opacity: 0.7;
    }

    /* feels like & high/low in one line */
    .extra-row {
      display: flex;
      justify-content: center;
      gap: 28px;
      font-size: 12px;
      letter-spacing: 0.2em;
      text-transform: lowercase;
      opacity: 0.7;
      border-top: 1px solid rgba(229,229,229,0.2);
      padding-top: 16px;
      margin-top: 8px;
    }

    /* error & spinner (borderless) */
    .error-msg {
      border: none;               /* removed border */
      color: #e5e5e5;
      padding: 8px 16px;
      border-radius: 40px;
      font-size: 12px;
      letter-spacing: 0.1em;
      text-align: center;
      background: transparent;
      margin-bottom: 10px;
    }

    .spinner {
      display: inline-block;
      width: 20px;
      height: 20px;
      border: 2px solid rgba(229,229,229,0.3);
      border-radius: 50%;
      border-top-color: #e5e5e5;
      animation: spin 0.8s linear infinite;
    }

    @keyframes spin { to { transform: rotate(360deg); } }

    .sr-only { position: absolute; width: 1px; height: 1px; padding: 0; margin: -1px; overflow: hidden; }

    @media (max-width: 480px) {
      .weather-card { padding: 24px 20px; }
      .temp { font-size: 4rem; }
      .search-input { min-width: 160px; }
    }
  </style>
</head>
<body>
  <!-- lofi navigation (customised for weather) -->
  <nav>
    <div>weather</div>
    <div>by h1m</div>
  </nav>

  <main>
    <!-- search row with unit toggle (borderless) -->
    <div class="search-row">
      <input type="text" id="cityInput" class="search-input" placeholder="city (e.g. London)" value="London" autofocus>
      <button class="btn" id="searchBtn" aria-label="search"><i class="fa-solid fa-magnifying-glass"></i></button>
      <button class="btn" id="geoBtn" aria-label="use my location"><i class="fa-solid fa-location-dot"></i></button>
      <button class="btn unit-toggle" id="unitToggle">°C</button>
    </div>

    <!-- error display -->
    <div id="errorBox" class="error-msg" style="display: none;"></div>

    <!-- minimal weather card (borderless) -->
    <div class="weather-card">
      <div class="location" id="location">—</div>

      <div class="main-temp">
        <span class="temp" id="currentTemp">—</span>
        <span class="main-icon" id="mainIcon"><i class="fa-solid fa-cloud"></i></span>
      </div>

      <!-- two‑column stats -->
      <div class="stats-grid">
        <div class="stat-item"><i class="fa-solid fa-wind"></i> <span id="windSpeed">—</span></div>
        <div class="stat-item"><i class="fa-solid fa-droplet"></i> <span id="humidity">—</span></div>
        <div class="stat-item"><i class="fa-solid fa-gauge-high"></i> <span id="pressure">—</span></div>
        <div class="stat-item"><i class="fa-solid fa-arrow-up-wide-short"></i> <span id="highLow">—</span></div>
      </div>

      <!-- feels like and condition description -->
      <div class="extra-row">
        <span id="feelsLike">—</span>
        <span id="weatherDesc">—</span>
      </div>
    </div>

    <!-- loading spinner (hidden by default) -->
    <div id="loadingSpinner" style="display: none;"><div class="spinner"></div></div>
  </main>

  <script>
    (function() {
      // ----- minimal DOM elements -----
      const DOM = {
        cityInput: document.getElementById('cityInput'),
        searchBtn: document.getElementById('searchBtn'),
        geoBtn: document.getElementById('geoBtn'),
        unitToggle: document.getElementById('unitToggle'),
        errorBox: document.getElementById('errorBox'),
        locationEl: document.getElementById('location'),
        tempEl: document.getElementById('currentTemp'),
        mainIcon: document.getElementById('mainIcon'),
        windSpeed: document.getElementById('windSpeed'),
        humidity: document.getElementById('humidity'),
        pressure: document.getElementById('pressure'),
        highLow: document.getElementById('highLow'),
        feelsLike: document.getElementById('feelsLike'),
        weatherDesc: document.getElementById('weatherDesc'),
        spinner: document.getElementById('loadingSpinner')
      };

      // state
      let currentWeather = null;
      let dailyData = [];
      let currentCity = 'London';
      let lat = 51.5074, lon = -0.1278;
      let unit = 'C';

      // helpers
      function showError(msg) {
        DOM.errorBox.style.display = 'block';
        DOM.errorBox.textContent = msg;
        setTimeout(() => { DOM.errorBox.style.display = 'none'; }, 4000);
      }

      function setLoading(state) {
        DOM.spinner.style.display = state ? 'flex' : 'none';
      }

      function degToCompass(deg) {
        if (deg === undefined) return '—';
        const val = Math.floor((deg / 22.5) + 0.5);
        const arr = ['N','NNE','NE','ENE','E','ESE','SE','SSE','S','SSW','SW','WSW','W','WNW','NW','NNW'];
        return arr[val % 16];
      }

      function codeToDesc(code) {
        const map = {
          0:'clear', 1:'mainly clear', 2:'partly cloudy', 3:'overcast',
          45:'fog', 48:'fog', 51:'drizzle', 53:'drizzle', 55:'drizzle',
          61:'rain', 63:'rain', 65:'heavy rain', 80:'showers', 81:'showers', 82:'showers',
          71:'snow', 73:'snow', 75:'heavy snow', 77:'snow grains', 85:'snow showers', 86:'snow showers',
          95:'thunder', 96:'thunder', 99:'thunder'
        };
        return map[code] || '—';
      }

      function codeToIcon(code) {
        const cat = (c) => {
          if (c === 0) return 'sun';
          if ([1,2,3].includes(c)) return 'cloud';
          if ([45,48].includes(c)) return 'smog';
          if ([51,53,55,56,57,61,63,65,66,67,80,81,82].includes(c)) return 'cloud-rain';
          if ([71,73,75,77,85,86].includes(c)) return 'snowflake';
          if ([95,96,99].includes(c)) return 'bolt';
          return 'cloud';
        };
        return `fa-${cat(code)}`;
      }

      function formatTemp(c) {
        if (c === undefined) return '—';
        return unit === 'C' ? Math.round(c) + '°' : Math.round(c * 9/5 + 32) + '°';
      }

      function formatSpeed(kmh) {
        if (kmh === undefined) return '—';
        return unit === 'C' ? kmh + 'km/h' : (kmh * 0.621371).toFixed(0) + 'mph';
      }

      function formatPress(hpa) {
        return hpa ? Math.round(hpa) + 'hPa' : '—';
      }

      // update UI with currentWeather and dailyData
      function updateUI() {
        if (!currentWeather) return;
        const w = currentWeather;

        DOM.locationEl.textContent = currentCity;
        DOM.tempEl.textContent = formatTemp(w.temperature);
        DOM.mainIcon.innerHTML = `<i class="fa-solid ${codeToIcon(w.weathercode)}"></i>`;

        // wind + direction
        let windStr = '—';
        if (w.windspeed !== undefined) {
          windStr = formatSpeed(w.windspeed);
          if (w.winddirection !== undefined) windStr += ' ' + degToCompass(w.winddirection);
        }
        DOM.windSpeed.textContent = windStr;

        DOM.humidity.textContent = w.humidity !== undefined ? w.humidity + '%' : '—';
        DOM.pressure.textContent = formatPress(w.pressure);

        // high/low from daily
        if (dailyData[0]) {
          DOM.highLow.textContent = `${formatTemp(dailyData[0].max)}/${formatTemp(dailyData[0].min)}`;
        } else {
          DOM.highLow.textContent = '—';
        }

        DOM.feelsLike.textContent = w.apparent_temperature ? `feels ${formatTemp(w.apparent_temperature)}` : '—';
        DOM.weatherDesc.textContent = codeToDesc(w.weathercode);
      }

      // fetch weather from open-meteo
      async function fetchWeather(lat, lon, cityName) {
        setLoading(true);
        DOM.errorBox.style.display = 'none';
        try {
          const url = `https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current=temperature_2m,apparent_temperature,weather_code,wind_speed_10m,wind_direction_10m,relative_humidity_2m,pressure_msl&daily=temperature_2m_max,temperature_2m_min&timezone=auto`;
          const res = await fetch(url);
          if (!res.ok) throw new Error('fetch failed');
          const data = await res.json();

          const cur = data.current;
          currentWeather = {
            temperature: cur.temperature_2m,
            apparent_temperature: cur.apparent_temperature,
            weathercode: cur.weather_code,
            windspeed: cur.wind_speed_10m,
            winddirection: cur.wind_direction_10m,
            humidity: cur.relative_humidity_2m,
            pressure: cur.pressure_msl
          };

          dailyData = [];
          if (data.daily) {
            for (let i = 0; i < data.daily.time.length; i++) {
              dailyData.push({
                max: data.daily.temperature_2m_max[i],
                min: data.daily.temperature_2m_min[i]
              });
            }
          }

          currentCity = cityName;
          updateUI();
          localStorage.setItem('lastCity', cityName);
        } catch (err) {
          showError('error loading weather');
        } finally {
          setLoading(false);
        }
      }

      // geocoding (city search)
      async function searchCity(query) {
        if (!query.trim()) return;
        setLoading(true);
        try {
          const geoRes = await fetch(`https://geocoding-api.open-meteo.com/v1/search?name=${encodeURIComponent(query)}&count=1`);
          const geo = await geoRes.json();
          if (!geo.results || geo.results.length === 0) throw new Error('city not found');
          const r = geo.results[0];
          lat = r.latitude;
          lon = r.longitude;
          const display = r.name + (r.country ? ', ' + r.country : '');
          await fetchWeather(lat, lon, display);
        } catch (e) {
          showError('city not found');
          setLoading(false);
        }
      }

      // geolocation
      function handleGeolocate() {
        if (!navigator.geolocation) { showError('geo not supported'); return; }
        setLoading(true);
        navigator.geolocation.getCurrentPosition(async (pos) => {
          try {
            const { latitude, longitude } = pos.coords;
            const revRes = await fetch(`https://geocoding-api.open-meteo.com/v1/reverse?latitude=${latitude}&longitude=${longitude}&count=1`);
            const rev = await revRes.json();
            let cityName = 'current location';
            if (rev.results && rev.results[0]) {
              const r = rev.results[0];
              cityName = r.name + (r.country ? ', ' + r.country : '');
            }
            await fetchWeather(latitude, longitude, cityName);
          } catch (e) {
            showError('reverse geocoding failed');
            setLoading(false);
          }
        }, () => {
          showError('location permission denied');
          setLoading(false);
        });
      }

      // unit toggle
      function toggleUnit() {
        unit = unit === 'C' ? 'F' : 'C';
        DOM.unitToggle.textContent = unit === 'C' ? '°C' : '°F';
        updateUI(); // re-render with new unit
      }

      // load last city or default
      function initLastCity() {
        const last = localStorage.getItem('lastCity');
        if (last) {
          DOM.cityInput.value = last.split(',')[0];
          searchCity(last.split(',')[0]);
        } else {
          searchCity('London');
        }
      }

      // event listeners
      DOM.searchBtn.addEventListener('click', () => searchCity(DOM.cityInput.value));
      DOM.cityInput.addEventListener('keypress', (e) => { if (e.key === 'Enter') searchCity(DOM.cityInput.value); });
      DOM.geoBtn.addEventListener('click', handleGeolocate);
      DOM.unitToggle.addEventListener('click', toggleUnit);

      // start
      DOM.cityInput.focus();
      initLastCity();
    })();
  </script>
</body>
</html>